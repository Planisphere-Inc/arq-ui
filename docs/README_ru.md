# arq-ui

Этот проект представляет собой простой интерфейс для мониторинга задач, выполняемых с помощью библиотеки [arq](https://github.com/samuelcolvin/arq).

![arq UI](screenshot1.png)

## Возможности

- Предоставление статистики по статусам задач: общее количество, количество задач в очереди, выполняющиеся задачи, задачи с ошибками.
- Визуализация распределения задач по времени в виде временной шкалы.
- Отображение списка задач с возможностями фильтрации, поиска и сортировки.
- Возможность отмены выполнения задач.

## Особенности

- Интерфейс считывает данные непосредственно из Redis, не храня состояние задач, что позволяет отслеживать задачи только за последний час. Планируется добавить функционал постоянного хранения данных.
- `arq` использует библиотеку `pickle` для сериализации данных и влечёт за собой ограничение возможности десериализации объектов пользовательских классов, к которым нет доступа. Если `arq-ui` не может десериализовать данные, задачи с такими данными не будут отображаться в мониторинге.
- Для возможности отмены задач необходимо, чтобы воркер был настроен с параметром `allow_abort_jobs`.
- При обработке большого количества задач (более 50 000) производительность приложения может снизиться.
- Интерфейс не обладает встроенными средствами защиты, поэтому его не рекомендуется размещать в открытом доступе без дополнительных мер безопасности.

## Демонстрация

Демо-версия доступна по адресу [https://demo.arq-ui.florm.io/arq/ui/](https://demo.arq-ui.florm.io/arq/ui/).

## Установка и запуск

### Использование Docker

Для запуска:

```bash
docker pull antonk0/arq-ui
docker run -p 8000:8000 -e REDIS_HOST=redis.host.com -e REDIS_PORT=6379 antonk0/arq-ui
```

Пример docker-compose.yml

```yaml
version: '3'
services:
  arq-ui:
    image: antonk0/arq-ui:latest
    restart: unless-stopped
    environment:
      - REDIS_HOST=redis.host.com
      - REDIS_PASSWORD=your_password
      - REDIS_PORT=6379
      - REDIS_SSL=False
      - REDIS_DB=0
    ports:
      - 8000:8000
```

### Запуск из исходного кода

Скачайте последний стабильный релиз с GitHub релизов, распакуйте и выполните следующие команды:

```bash
pdm install
cd src
pdm run uvicorn main:app --host=0.0.0.0 --port=8000
```

Если pdm не установлен, его можно установить с помощью pip:

```bash
pip install pdm
```

## Настройка

Интерфейс доступен по адресу `/arq/ui/`. Swagger документация API доступна на `/arq/api/docs/`.

Возможные переменные окружения:

| Переменная | Описание | Значение по умолчанию |
| ------ | ------ | ------ |
| REDIS_HOST | Адрес redis сервера | redis |
| REDIS_PORT | Порт redis сервера | 6379 |
| REDIS_PASSWORD | Пароль для подключения к redis | "" (нет пароля) |
| REDIS_SSL | Использовать ли ssl для подключения к redis | False |
| REDIS_DB | Номер базы данных redis | 0 |
| MAX_JOBS | Максимальное количество задач, которые могут быть отображены в интерфейсе | 50000 |
| REQUEST_SEMAPHORE_JOBS | Количество задач, которые могут быть запрошены одновременно | 5 |
| QUEUE_NAME | Название очереди в redis | arq:queue |



## Development


```
docker compose -f docker-compose.dev.yml build
docker compose -f docker-compose.dev.yml up
```

### Links

| Name | Link |
| ------ | ------ |
| Frontend | [http://localhost:5173/arq/ui](http://localhost:5173/arq/ui) |
| Backend | [http://localhost:8000/arq/api/docs](http://localhost:8000/arq/api/docs) |
| P3X Redis UI | [http://localhost:7843/](http://localhost:7843/) |